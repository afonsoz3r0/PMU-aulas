<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Lista de Tarefas</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="navegarParaCriarTarefa()">
        <ion-icon name="add" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Lista de Tarefas</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="page-container">
    <!-- Search Bar -->
    <div class="search-section mb-md">
      <ion-searchbar
        [(ngModel)]="searchQuery"
        (ionInput)="onSearchChange($event)"
        placeholder="Pesquisar tarefas..."
        debounce="300"
        class="searchbar-modern">
      </ion-searchbar>
    </div>

    <!-- Filters Group -->
    <div class="filters-group" *ngIf="projetos.length > 0 || categorias.length > 0">
      <p class="filters-title">Filtros</p>
      
      <div class="filters-content">
        <ion-item *ngIf="projetos.length > 0" class="filter-item">
          <ion-label position="stacked">Projeto</ion-label>
          <ion-select [(ngModel)]="filterProjetoId" (ionChange)="onFilterProjetoChange($event)" placeholder="Todos">
            <ion-select-option [value]="null">Todos</ion-select-option>
            <ion-select-option *ngFor="let projeto of projetos" [value]="projeto.id">
              {{ projeto.nome }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item *ngIf="categorias.length > 0" class="filter-item">
          <ion-label position="stacked">Categoria</ion-label>
          <ion-select [(ngModel)]="filterCategoria" (ionChange)="onFilterCategoriaChange($event)" placeholder="Todas">
            <ion-select-option value="">Todas</ion-select-option>
            <ion-select-option *ngFor="let cat of categorias" [value]="cat">
              {{ cat }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item class="filter-item">
          <ion-label>
            <h3>Mostrar apenas atrasadas</h3>
            <p *ngIf="atrasadas.length > 0" class="filter-hint">{{ atrasadas.length }} tarefa(s) atrasada(s)</p>
          </ion-label>
          <ion-toggle [(ngModel)]="mostrarAtrasadas" (ionChange)="toggleAtrasadas()" slot="end"></ion-toggle>
        </ion-item>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <ion-spinner></ion-spinner>
      <p>Carregando tarefas...</p>
    </div>

    <!-- Tasks Section -->
    <div *ngIf="!loading" class="tasks-section">
      <app-tarefa-card 
        [titulo]="'To Do'" 
        [tarefas]="toDo"
        (editarTarefa)="onEditarTarefa($event)"
        (eliminarTarefa)="onEliminarTarefa($event, 'To Do')"
        (reordenarTarefas)="onReordenarTarefas($event.event, $event.tipo)">
      </app-tarefa-card>

      <app-tarefa-card 
        [titulo]="'In Progress'" 
        [tarefas]="inProgress"
        (editarTarefa)="onEditarTarefa($event)"
        (eliminarTarefa)="onEliminarTarefa($event, 'In Progress')"
        (reordenarTarefas)="onReordenarTarefas($event.event, $event.tipo)">
      </app-tarefa-card>

      <app-tarefa-card 
        [titulo]="'Done'" 
        [tarefas]="done"
        (editarTarefa)="onEditarTarefa($event)"
        (eliminarTarefa)="onEliminarTarefa($event, 'Done')"
        (reordenarTarefas)="onReordenarTarefas($event.event, $event.tipo)">
      </app-tarefa-card>
    </div>
  </div>

  <!-- FAB para adicionar tarefa -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="navegarParaCriarTarefa()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
